<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Texture Porter GD!</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  
  <style>
    :root {
      --music-pink: #ff2d55;
      --bg-overlay: rgba(242, 242, 247, 0.25);
      --glass: rgba(255, 255, 255, 0.45);
      --border: rgba(255, 255, 255, 0.5);
      --text: #000000;
      --sub-text: rgba(0, 0, 0, 0.6);
    }
    body.dark-mode {
      --bg-overlay: rgba(0, 0, 0, 0.4);
      --glass: rgba(28, 28, 30, 0.5);
      --border: rgba(255, 255, 255, 0.15);
      --text: #ffffff;
      --sub-text: rgba(255, 255, 255, 0.5);
    }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif; 
      margin: 0; padding: 0; min-height: 100vh;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      color: var(--text); overflow: hidden;
    }
    .custom-bg {
      position: fixed; top: -30px; left: -30px; right: -30px; bottom: -30px; 
      background-image: url('fondo.jpg'); background-size: cover;
      background-position: center; filter: blur(10px); z-index: -2;
    }
    .bg-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: var(--bg-overlay); z-index: -1; transition: background 0.5s ease;
    }
    .top-controls {
      position: absolute; top: 20px; left: 20px; right: 20px;
      display: flex; justify-content: space-between; align-items: center; z-index: 10;
    }
    .btn-top {
      background: var(--glass); border: 1px solid var(--border); padding: 15px; border-radius: 50%; 
      cursor: pointer; backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
      display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }
    .contenedor {
      background: var(--glass); backdrop-filter: blur(35px) saturate(180%);
      -webkit-backdrop-filter: blur(35px) saturate(180%);
      border: 1px solid var(--border); border-radius: 40px;
      padding: 35px 25px; width: 85%; max-width: 350px; text-align: center;
    }
    h1 { font-size: 28px; font-weight: 800; letter-spacing: -1.5px; margin: 0; }
    .drop-zone {
      background: rgba(128,128,128,0.05); border: 1px dashed var(--sub-text);
      border-radius: 30px; padding: 45px 20px; cursor: pointer; display: block; margin-top: 20px;
    }
    #status { font-size: 11px; color: var(--music-pink); margin-top: 20px; font-weight: 800; }
    #saveBtn {
      background: var(--music-pink); color: #ffffff; border: none; padding: 18px; border-radius: 24px; 
      width: 100%; font-weight: 800; margin-top: 20px; display: none; cursor: pointer;
    }
    .mini-player {
      margin-top: 20px; background: var(--glass); border-radius: 30px;
      padding: 18px 25px; width: 85%; max-width: 350px; border: 1px solid var(--border);
      display: flex; justify-content: space-between; align-items: center; backdrop-filter: blur(35px) saturate(180%);
    }
    .social-bar { margin-top: 20px; display: flex; gap: 12px; width: 85%; max-width: 350px; }
    .social-btn {
      flex: 1; background: var(--glass); border: 1px solid var(--border); padding: 14px; border-radius: 22px;
      text-decoration: none; color: var(--text); font-size: 13px; font-weight: 700;
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
  </style>
</head>
<body id="mainBody">

<div class="custom-bg"></div>
<div class="bg-overlay"></div>

<div class="top-controls">
  <button class="btn-top" id="btnMute">
    <svg width="24" height="24" viewBox="0 0 24 24"><path id="m-ico" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
  </button>
  <div class="btn-top" id="themeBtn" style="padding: 12px; font-size: 20px;">üåì</div>
</div>

<div class="contenedor">
  <h1>Texture Porter GD!</h1>
  <label for="file" class="drop-zone">
    <span style="font-weight: 600;">Importar Pack o ZIP</span>
  </label>
  <input type="file" id="file" style="display:none;" multiple>
  <div id="status">READY</div>
  <button id="saveBtn">DESCARGAR PACK HD</button>
</div>

<div class="mini-player">
  <div style="text-align: left;"><span style="font-size: 14px; font-weight: 700; display: block;">menuLoop</span><span style="font-size: 12px; color: var(--music-pink);">Geometry Dash OST</span></div>
  <div style="display: flex; gap: 15px; align-items: center;">
    <button style="background:none; border:none; cursor:pointer;" onclick="audio.currentTime -= 10">‚è™</button>
    <button id="btnPlay" style="background:none; border:none; cursor:pointer; font-size: 24px;">‚ñ∂Ô∏è</button>
    <button style="background:none; border:none; cursor:pointer;" onclick="audio.currentTime += 10">‚è©</button>
  </div>
  <audio id="audio" loop src="menuLoop.mp3"></audio>
</div>

<div class="social-bar">
  <a href="https://discord.gg/cVn3Brk3Uw" target="_blank" class="social-btn">Discord</a>
  <a href="https://www.tiktok.com/@_ketsutt" target="_blank" class="social-btn">TikTok</a>
</div>

<script>
  const body = document.getElementById('mainBody'); const audio = document.getElementById('audio');
  const st = document.getElementById('status'); const sv = document.getElementById('saveBtn');
  const mIco = document.getElementById('m-ico'); const pBtn = document.getElementById('btnPlay');

  document.getElementById('themeBtn').onclick = () => body.classList.toggle('dark-mode');
  function playMusic() { audio.play().then(() => pBtn.innerText = "‚è∏Ô∏è").catch(()=>{}); }
  pBtn.onclick = () => { if(audio.paused) playMusic(); else { audio.pause(); pBtn.innerText = "‚ñ∂Ô∏è"; } };
  document.getElementById('btnMute').onclick = () => { 
    audio.muted = !audio.muted; 
    mIco.setAttribute('d', audio.muted ? "M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z" : "M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z");
  };
  document.addEventListener('click', () => { if(audio.paused && audio.currentTime === 0) playMusic(); }, { once: true });

  const processData = (txt) => {
    let res = txt.replace(/\{\s*([-+]?\d*\.?\d+)\s*,\s*([-+]?\d*\.?\d+)\s*\}/g, (m, x, y) => {
        return `{${Math.floor(parseFloat(x)/2)},${Math.floor(parseFloat(y)/2)}}`;
    });
    const fields = ['x', 'y', 'width', 'height', 'xoffset', 'yoffset', 'xadvance', 'size', 'base', 'lineHeight', 'scaleW', 'scaleH'];
    fields.forEach(f => {
      const regex = new RegExp(`\\b${f}=([-+]?\\d+)\\b`, 'g');
      res = res.replace(regex, (m, val) => `${f}=${Math.floor(parseInt(val)/2)}`);
    });
    return res.replace(/-uhd/gi, '-hd');
  };

  const resizeHighQuality = (blob) => {
    return new Promise((res) => {
      const img = new Image(); const url = URL.createObjectURL(blob);
      img.onload = () => {
        const c = document.createElement('canvas');
        c.width = Math.floor(img.width / 2); c.height = Math.floor(img.height / 2);
        const ctx = c.getContext('2d');
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high'; // Calidad m√°xima para iconos GD
        ctx.drawImage(img, 0, 0, c.width, c.height);
        c.toBlob((b) => { URL.revokeObjectURL(url); res(b); }, 'image/png');
      };
      img.src = url;
    });
  };

  document.getElementById('file').addEventListener('change', async function(e) {
    const files = e.target.files; if(!files.length) return;
    const zipOut = new JSZip(); st.innerText = "PROCESANDO PACK...";
    for (let f of files) {
      if (f.name.toLowerCase().endsWith('.zip')) {
        const zipIn = await JSZip.loadAsync(f);
        for (let path in zipIn.files) {
          const entry = zipIn.files[path];
          if (entry.dir || path.includes('__MACOSX')) continue;
          let newPath = path.replace(/-uhd/gi, '-hd');
          if (path.toLowerCase().endsWith('.png')) {
            zipOut.file(newPath, await resizeHighQuality(await entry.async("blob")));
          } else if (path.toLowerCase().endsWith('.plist') || path.toLowerCase().endsWith('.fnt')) {
            zipOut.file(newPath, processData(await entry.async("string")));
          } else { zipOut.file(newPath, await entry.async("blob")); }
        }
      } else {
        let n = f.name.replace(/-uhd/gi, '-hd');
        if (f.name.toLowerCase().endsWith('.png')) zipOut.file(n, await resizeHighQuality(f));
        else if (f.name.toLowerCase().endsWith('.plist') || f.name.toLowerCase().endsWith('.fnt')) zipOut.file(n, processData(await f.text()));
        else zipOut.file(n, f);
      }
    }
    st.innerText = "¬°LISTO!"; sv.style.display = "block";
    sv.onclick = async () => {
      const content = await zipOut.generateAsync({type:"blob"});
      const a = document.createElement("a"); a.href = URL.createObjectURL(content);
      a.download = "GD_Fix_Quality.zip"; a.click();
    };
  });
</script>
</body>
</html>
